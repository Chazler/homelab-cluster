cilium:
  # IPAM Configuration
  ipam:
    mode: kubernetes

  # Network Interface Configuration
  devices: "enp1s0"

  # L2 Announcements for LoadBalancer services
  l2Announcements:
    enabled: true
  
  enableL2NeighDiscovery: true

  # Kube-proxy replacement
  kubeProxyReplacement: true
  
  # API Server Configuration
  k8sServiceHost: 10.0.0.10
  k8sServicePort: 6443

  # Talos-specific security context
  securityContext:
    capabilities:
      ciliumAgent: [ CHOWN,KILL,NET_ADMIN,NET_RAW,IPC_LOCK,SYS_ADMIN,SYS_RESOURCE,DAC_OVERRIDE,FOWNER,SETGID,SETUID ]
      cleanCiliumState: [ NET_ADMIN,SYS_ADMIN,SYS_RESOURCE ]
  # Talos-specific cgroup configuration
  cgroup:
    autoMount:
      enabled: false
    hostRoot: /sys/fs/cgroup

  # Host Firewall - Enhanced security
  hostFirewall:
    enabled: true

  # Socket-level load balancing - Performance optimization
  socketLB:
    hostNamespaceOnly: true

  # Pod rollout - Zero-downtime upgrades
  rollOutCiliumPods: true

  # Envoy Proxy Configuration
  envoy:
    enabled: true
    rollOutPods: true
    prometheus:
      enabled: true
      serviceMonitor:
        enabled: true

  # Monitoring Configuration
  monitor:
    enabled: true

  prometheus:
    enabled: true
    serviceMonitor:
      enabled: true

  dashboards:
    enabled: true
    annotations:
      argocd.argoproj.io/sync-options: ServerSideApply=true

  # Hubble Configuration - Observability
  hubble:
    metrics:
      enabled:
        - dns
        - drop
        - tcp
        - flow
        - port-distribution
        - icmp
        - httpV2:exemplars=true;labelsContext=source_ip,source_namespace,source_workload,destination_ip,destination_namespace,destination_workload,traffic_direction
      serviceMonitor:
        enabled: true
      dashboards:
        enabled: true
        annotations:
          argocd.argoproj.io/sync-options: ServerSideApply=true
    
    tls:
      auto:
        enabled: true
        method: cronJob
        certValidityDuration: 1095  # 3 years
    
    relay:
      enabled: true
      rollOutPods: true
      prometheus:
        enabled: true
        serviceMonitor:
          enabled: true
    
    ui:
      enabled: true
      rollOutPods: true

  # Operator Configuration
  operator:
    replicas: 1
    rollOutPods: true
    prometheus:
      enabled: true
      serviceMonitor:
        enabled: true
    dashboards:
      enabled: true
      annotations:
        argocd.argoproj.io/sync-options: ServerSideApply=true
